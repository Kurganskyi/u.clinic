# План разработки Telegram-бота Uclinic v1.0 (Минимальный MVP)

## Общая информация

**Версия:** 1.0 (Минимальный MVP)  
**Цель:** Автоматизация уведомлений клиентов о записях и напоминаниях  
**Бюджет:** Минимальный для быстрого запуска

---

## Функциональные требования v1.0

### ✅ ВКЛЮЧЕНО (Must Have):

1. **Уведомление о записи** (пункт 1)
   - Получение данных из Битрикс24 (вебхук или API)
   - Отправка сообщения клиенту в Telegram
   - Определенная форма сообщения

2. **Напоминание за 24 часа** (пункт 2)
   - Автоматическая отправка за 24ч до записи
   - Кнопки "Да, приду" / "Нет, не получается"
   - Сохранение ответа в БД
   - Обновление статуса в Битрикс24

3. **Опрос через 3 дня** (пункт 3)
   - Автоматическая отправка через 3 дня после процедуры
   - Оценка от 1 до 5
   - Если 5 баллов → ссылка на Яндекс.Карты с предзаполненным текстом

### ❌ ИСКЛЮЧЕНО (будут в следующих версиях):

- ❌ Рассылки (пункт 4) - версия 2.0
- ❌ Детальная статистика (пункт 5) - будет базовая в v1.0
- ❌ Полное копирование меню из @Uclinic1Bot (пункт 6) - минимальное меню
- ❌ Очереди задач Celery - используем APScheduler
- ❌ Детальная аналитика - минимальные метрики
- ❌ Compliance инструменты - базовая безопасность
- ❌ Интеграционное тестирование - только smoke-тесты

---

## Архитектура v1.0 (упрощенная)

### Структура проекта

```
u.clinic/
├── bot/
│   ├── __init__.py
│   ├── main.py                    # Точка входа
│   ├── handlers/
│   │   ├── __init__.py
│   │   ├── notifications.py       # Уведомления о записи
│   │   ├── reminders.py           # Напоминания за 24ч
│   │   └── survey.py              # Опросы
│   ├── services/
│   │   ├── __init__.py
│   │   ├── bitrix24.py            # Интеграция с Битрикс24
│   │   ├── yandex_maps.py         # Генерация ссылок Яндекс
│   │   └── scheduler.py           # Планировщик APScheduler
│   ├── models/
│   │   ├── __init__.py
│   │   ├── user.py                # Пользователь
│   │   ├── appointment.py         # Запись
│   │   └── survey.py              # Результаты опроса
│   ├── utils/
│   │   ├── keyboards.py           # Клавиатуры
│   │   └── messages.py            # Шаблоны сообщений
│   └── config.py                  # Конфигурация
├── .env.example
├── requirements.txt
├── README.md
└── docs/
```

### Технологии (минимальный стек)

- **Язык:** Python 3.10+
- **Библиотека бота:** python-telegram-bot v20+ (синхронная версия для простоты)
- **Планировщик:** APScheduler (легче чем Celery)
- **БД:** SQLite (для MVP, PostgreSQL в продакшне)
- **ORM:** SQLAlchemy
- **Битрикс24:** requests + REST API
- **Вебхуки:** Flask для приема вебхуков от Битрикс24

---

## Разбивка работ по этапам

### Этап 1: Настройка проекта (16 часов)

| Работа | Часы | Исполнитель | Стоимость/час | Сумма |
|--------|------|-------------|---------------|-------|
| Создание структуры проекта | 2 | Backend | 2,500 | 5,000 |
| Настройка зависимостей (requirements.txt) | 2 | Backend | 2,500 | 5,000 |
| Настройка .env и конфигурации | 2 | Backend | 2,500 | 5,000 |
| Инициализация БД (SQLite + миграции) | 6 | Backend | 2,500 | 15,000 |
| Настройка python-telegram-bot | 4 | Backend | 2,500 | 10,000 |
| **Итого Этап 1** | **16** | | | **40,000** |

### Этап 2: Интеграция с Битрикс24 (20 часов)

| Работа | Часы | Исполнитель | Стоимость/час | Сумма |
|--------|------|-------------|---------------|-------|
| Изучение Битрикс24 API | 4 | Backend | 2,500 | 10,000 |
| Настройка исходящего вебхука в Битрикс24 | 2 | Backend | 2,500 | 5,000 |
| Flask endpoint для приема вебхуков | 6 | Backend | 2,500 | 15,000 |
| REST API клиент для получения данных | 4 | Backend | 2,500 | 10,000 |
| Обновление статусов в Битрикс24 | 4 | Backend | 2,500 | 10,000 |
| **Итого Этап 2** | **20** | | | **50,000** |

### Этап 3: Уведомление о записи (20 часов)

| Работа | Часы | Исполнитель | Стоимость/час | Сумма |
|--------|------|-------------|---------------|-------|
| Разработка шаблона сообщения | 4 | UX-копирайтер | 2,000 | 8,000 |
| Обработка вебхука ONCRMDEALADD | 6 | Backend | 2,500 | 15,000 |
| Получение данных о записи через API | 4 | Backend | 2,500 | 10,000 |
| Отправка уведомления клиенту | 4 | Backend | 2,500 | 10,000 |
| Обработка ошибок (клиент не в Telegram) | 2 | Backend | 2,500 | 5,000 |
| **Итого Этап 3** | **20** | | | **48,000** |

### Этап 4: Напоминание за 24 часа (20 часов)

| Работа | Часы | Исполнитель | Стоимость/час | Сумма |
|--------|------|-------------|---------------|-------|
| Настройка APScheduler | 4 | Backend | 2,500 | 10,000 |
| Создание задачи в планировщике при записи | 4 | Backend | 2,500 | 10,000 |
| Отправка напоминания за 24ч | 4 | Backend | 2,500 | 10,000 |
| Кнопки "Да, приду" / "Нет" | 4 | Backend | 2,500 | 10,000 |
| Обработка ответов и обновление БД | 4 | Backend | 2,500 | 10,000 |
| **Итого Этап 4** | **20** | | | **50,000** |

### Этап 5: Опрос через 3 дня (16 часов)

| Работа | Часы | Исполнитель | Стоимость/час | Сумма |
|--------|------|-------------|---------------|-------|
| Создание задачи для опроса через 3 дня | 4 | Backend | 2,500 | 10,000 |
| Отправка опроса с оценками 1-5 | 4 | Backend | 2,500 | 10,000 |
| Генерация ссылки Яндекс.Карты | 4 | Backend | 2,500 | 10,000 |
| Обработка результата и сохранение | 4 | Backend | 2,500 | 10,000 |
| **Итого Этап 5** | **16** | | | **40,000** |

### Этап 6: Минимальное меню (12 часов)

| Работа | Часы | Исполнитель | Стоимость/час | Сумма |
|--------|------|-------------|---------------|-------|
| Команды /start, /help | 2 | Backend | 2,500 | 5,000 |
| Базовая структура меню из @Uclinic1Bot | 8 | Backend | 2,500 | 20,000 |
| Обработка ошибок | 2 | Backend | 2,500 | 5,000 |
| **Итого Этап 6** | **12** | | | **30,000** |

### Этап 7: Безопасность и валидация (12 часов)

| Работа | Часы | Исполнитель | Стоимость/час | Сумма |
|--------|------|-------------|---------------|-------|
| Валидация Telegram ID пользователей | 4 | Backend | 2,500 | 10,000 |
| Хранение секретов в .env | 2 | DevOps | 2,500 | 5,000 |
| Базовая обработка ошибок | 4 | Backend | 2,500 | 10,000 |
| Логирование критичных операций | 2 | Backend | 2,500 | 5,000 |
| **Итого Этап 7** | **12** | | | **30,000** |

### Этап 8: Тестирование (24 часа)

| Работа | Часы | Исполнитель | Стоимость/час | Сумма |
|--------|------|-------------|---------------|-------|
| Smoke-тесты основных функций | 12 | QA | 2,000 | 24,000 |
| Тестирование интеграции с Битрикс24 | 8 | QA | 2,000 | 16,000 |
| Исправление найденных багов | 4 | Backend | 2,500 | 10,000 |
| **Итого Этап 8** | **24** | | | **50,000** |

### Этап 9: Деплой и документация (16 часов)

| Работа | Часы | Исполнитель | Стоимость/час | Сумма |
|--------|------|-------------|---------------|-------|
| Настройка production сервера | 6 | DevOps | 2,500 | 15,000 |
| Настройка systemd/PM2 для автозапуска | 4 | DevOps | 2,500 | 10,000 |
| Создание README и инструкций | 4 | Backend | 2,500 | 10,000 |
| Настройка базового мониторинга | 2 | DevOps | 2,500 | 5,000 |
| **Итого Этап 9** | **16** | | | **40,000** |

### Этап 10: Буфер на непредвиденное (20 часов)

| Работа | Часы | Исполнитель | Стоимость/час | Сумма |
|--------|------|-------------|---------------|-------|
| Исправление багов после тестов | 12 | Backend | 2,500 | 30,000 |
| Правки текстов | 8 | UX-копирайтер | 2,000 | 16,000 |
| **Итого Этап 10** | **20** | | | **46,000** |

---

## Итоговая калькуляция v1.0

### Прямые затраты

| Этап | Часы | Сумма, руб. |
|------|------|-------------|
| 1. Настройка проекта | 16 | 40,000 |
| 2. Интеграция с Битрикс24 | 20 | 50,000 |
| 3. Уведомление о записи | 20 | 48,000 |
| 4. Напоминание за 24 часа | 20 | 50,000 |
| 5. Опрос через 3 дня | 16 | 40,000 |
| 6. Минимальное меню | 12 | 30,000 |
| 7. Безопасность и валидация | 12 | 30,000 |
| 8. Тестирование | 24 | 50,000 |
| 9. Деплой и документация | 16 | 40,000 |
| 10. Буфер на непредвиденное | 20 | 46,000 |
| **ИТОГО** | **176** | **424,000** |

### Накладные расходы

| Статья | Процент | Сумма, руб. |
|--------|---------|-------------|
| Управление проектом | 5% | 21,200 |
| Нераспределенные расходы | 3% | 12,720 |
| **Итого накладные** | **8%** | **33,920** |

### Итоговая стоимость v1.0

**Сумма прямых затрат:** 424,000 ₽  
**Накладные расходы:** 33,920 ₽  
**ИТОГО СТОИМОСТЬ v1.0:** **457,920 ₽**

**Округленно:** **450,000 - 500,000 ₽**

---

## Таймлайн v1.0

### Последовательность разработки

**Неделя 1: Инфраструктура**
- Этапы 1, 2: 36 часов = 0.9 недели

**Неделя 2-3: Основная функциональность**
- Этапы 3, 4, 5: 56 часов = 1.4 недели

**Неделя 3-4: Доработка и тестирование**
- Этапы 6, 7: 24 часа = 0.6 недели

**Неделя 4-5: Тестирование и деплой**
- Этапы 8, 9: 40 часов = 1 неделя

**Неделя 5-6: Буфер и правки**
- Этап 10: 20 часов = 0.5 недели (размазано по проекту)

**ИТОГО: 5-6 недель (1.5 месяца)**

---

## Экономическое обоснование v1.0

### Сравнение с полной версией

| Параметр | Полная версия | v1.0 (Минимальная) | Экономия |
|----------|---------------|-------------------|----------|
| Трудозатраты | 520 часов | 176 часов | 66% |
| Стоимость | 1,539,000 ₽ | 457,920 ₽ | 1,081,080 ₽ |
| Срок разработки | 10-13 недель | 5-6 недель | 5-7 недель |
| Функций | 6 из 6 | 3 из 6 | 50% |

### ROI для v1.0

**Снижение неявок клиентов:**
- Экономия: 100,000 ₽/месяц
- Окупаемость: 457,920 ₽ / 100,000 ₽/мес = **4.6 месяца**

**ROI через 12 месяцев:** 162% ((100,000 × 12 - 457,920) / 457,920)

### Что получаем в v1.0

✅ **Основной функционал:**
- Автоматические уведомления о записях
- Напоминания за 24 часа
- Сбор обратной связи через опросы
- Интеграция с Битрикс24
- Базовая надежность и тестирование

✅ **Готовность к расширению:**
- Архитектура позволяет добавлять функции
- Простая миграция на PostgreSQL
- Возможность добавить Celery в будущем
- Модульная структура кода

### Что откладываем на v2.0

⏳ **Версия 2.0 (оценка +300,000-400,000 ₽):**
- Автоматические рассылки
- Детальная аналитика и дашборды
- Полное копирование меню @Uclinic1Bot
- Очереди задач (Celery)
- Дополнительная безопасность и compliance

---

## Риски v1.0

### Технические риски

| Риск | Митигация |
|------|-----------|
| SQLite может быть медленным при нагрузке | Простая миграция на PostgreSQL в будущем |
| APScheduler может потерять задачи при перезапуске | Персистентность в БД, восстановление при старте |
| Flask endpoint может не выдержать нагрузку | Переход на FastAPI или async при необходимости |

### Организационные риски

| Риск | Митигация |
|------|-----------|
| Недооценка времени | Буфер 20 часов заложен |
| Задержки согласования текстов | Готовые шаблоны в документации |
| Недоступность Битрикс24 | Резервный polling вместо вебхуков |

---

## Входные требования для v1.0

### От клиента:
- ✅ Доступ к Битрикс24 (настройка вебхуков)
- ✅ Токен Telegram-бота от @BotFather
- ✅ Тексты шаблонов уведомлений (или помощь в разработке)
- ✅ Название процедур и врачей для персонализации

### От разработчика:
- ✅ Сервер для размещения бота (можно VPS от 500 ₽/мес)
- ✅ Домен для приема вебхуков (опционально)

---

## Рекомендации

### ✅ ВЫБРАТЬ v1.0 если:

1. Нужен быстрый запуск (5-6 недель)
2. Ограниченный бюджет (450,000-500,000 ₽)
3. Достаточно основных уведомлений
4. Готовы дорабатывать в будущем
5. Хотите протестировать на реальных клиентах

### ❌ НЕ ВЫБИРАТЬ v1.0 если:

1. Нужны рассылки сразу
2. Нужна детальная статистика
3. Важна максимальная надежность (нужен полный стек)
4. Критически важна производительность на старте

---

## Итоговый вывод

**Стоимость v1.0: 450,000 - 500,000 ₽**  
**Срок разработки: 5-6 недель**  
**Окупаемость: 4.6 месяца**

**Преимущества:**
- В 3 раза дешевле полной версии
- В 2 раза быстрее разработка
- Все критичные функции для автоматизации
- Готовность к масштабированию

**Рекомендация:** Запустить v1.0, протестировать 2-3 месяца, затем заказать v2.0 с дополнительными функциями при необходимости.

